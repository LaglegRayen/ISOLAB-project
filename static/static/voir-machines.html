<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machines - ISOLAB Agri Support</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/workflow.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">ISOLAB Agri Support</h2>
                <p class="sidebar-subtitle">Système de gestion</p>
            </div>
            <ul class="sidebar-nav">
                <li><a href="#" id="nav-dashboard"><i class="fas fa-home"></i> Tableau de bord</a></li>
                <li><a href="#" id="nav-my-tasks"><i class="fas fa-tasks"></i> Mes tâches</a></li>
                <li><a href="#" id="nav-machines" class="active"><i class="fas fa-cogs"></i> Machines</a></li>
                <li id="nav-clients-item"><a href="#" id="nav-clients"><i class="fas fa-users"></i> Clients</a></li>
                <li id="nav-users-item"><a href="#" id="nav-users"><i class="fas fa-user-cog"></i> Utilisateurs</a></li>
                <li><a href="#" id="nav-logout" onclick="handleLogout(); return false;"><i class="fas fa-sign-out-alt"></i> Déconnexion</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="page-header">
                <h1 class="page-title">Gestion des machines</h1>
                <p>Recherchez et consultez les fiches techniques des machines OLIVIA</p>
            </div>

            <!-- Search Section -->
            <div class="search-section">
                <div class="search-container">
                    <div class="search-input-group">
                        <input type="text" id="machineSearch" class="search-bar" placeholder="Rechercher par numéro de série, client, société...">
                        <button class="btn btn-primary search-btn" onclick="searchMachine()">
                            <i class="fas fa-search"></i> Rechercher
                        </button>
                        <button class="btn btn-secondary" onclick="showAllMachines()">
                            <i class="fas fa-list"></i> Voir toutes
                        </button>
                        <button class="btn btn-success" onclick="addNewMachine()" id="add-machine-btn">
                            <i class="fas fa-plus"></i> Ajouter Machine
                        </button>
                    </div>
                </div>
                
                <div class="search-filters">
                    <select id="typeFilter" class="filter-select" onchange="filterMachines()">
                        <option value="">Tous les types</option>
                        <option value="olivia">Olivia</option>
                        <option value="olivia+broyeur">Olivia + Broyeur</option>
                    </select>
                    <select id="statusFilter" class="filter-select" onchange="filterMachines()">
                        <option value="">Tous les statuts</option>
                        <option value="En cours">En cours</option>
                        <option value="Terminé">Terminé</option>
                        <option value="Problème">Problème</option>
                    </select>
                </div>
            </div>

            <!-- Machines List -->
            <div id="machinesList" class="machines-list" style="display: none;">
                <div class="machines-grid" id="machinesGrid">
                    <!-- Machines will be loaded here -->
                </div>
            </div>

            <!-- Machine Details Display -->
            <div id="machineDetails" class="machine-details" style="display: none;">
                <div class="fiche-technique">
                    <div class="fiche-header">
                        <h2><i class="fas fa-cog"></i> Fiche technique</h2>
                        <div class="fiche-actions">
                            <button class="btn btn-secondary btn-small" onclick="printFiche()">
                                <i class="fas fa-print"></i> Imprimer
                            </button>
                            <button class="btn btn-primary btn-small" onclick="exportFiche()">
                                <i class="fas fa-download"></i> Exporter
                            </button>
                        </div>
                    </div>

                    <div class="fiche-content">
                        <!-- Machine Information -->
                        <div class="fiche-section">
                            <h3><i class="fas fa-cogs"></i> Informations Machine</h3>
                            <div class="fiche-grid">
                                <div class="fiche-item">
                                    <label>Numéro de série:</label>
                                    <span id="serialNumber">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Type de machine:</label>
                                    <span id="machineType">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Fiche technique N°:</label>
                                    <span id="ficheNumber">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Prix HT:</label>
                                    <span id="prixHT">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Prix TTC:</label>
                                    <span id="prixTTC">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Statut:</label>
                                    <span id="machineStatus" class="status-badge">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Client Information -->
                        <div class="fiche-section">
                            <h3><i class="fas fa-building"></i> Informations Client</h3>
                            <div class="fiche-grid">
                                <div class="fiche-item">
                                    <label>Société:</label>
                                    <span id="clientSociety">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Gérant:</label>
                                    <span id="clientName">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Matricule fiscale:</label>
                                    <span id="matriculeFiscale">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Téléphone:</label>
                                    <span id="clientPhone">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Email:</label>
                                    <span id="clientEmail">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Adresse:</label>
                                    <span id="clientAddress">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Localisation:</label>
                                    <span id="clientLocation">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Installation Information -->
                        <div class="fiche-section">
                            <h3><i class="fas fa-calendar-alt"></i> Informations Installation</h3>
                            <div class="fiche-grid">
                                <div class="fiche-item">
                                    <label>Date de livraison:</label>
                                    <span id="deliveryDate">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Date d'installation:</label>
                                    <span id="installationDate">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Installé par:</label>
                                    <span id="installedBy">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Livré par:</label>
                                    <span id="deliveredBy">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Décharge BL:</label>
                                    <span id="dischargeBL">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Facturation:</label>
                                    <span id="facturation">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Information -->
                        <div class="fiche-section">
                            <h3><i class="fas fa-credit-card"></i> Informations Paiement</h3>
                            <div class="fiche-grid">
                                <div class="fiche-item">
                                    <label>Type de paiement:</label>
                                    <span id="paymentType">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Statut paiement:</label>
                                    <span id="paymentStatus">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Confirmation:</label>
                                    <span id="confirmation">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Facturation:</label>
                                    <span id="facturation">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Commentaires paiement:</label>
                                    <span id="commentairesPaiement">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>ITP Status:</label>
                                    <span id="itpStatus">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Maintenance & Remarks -->
                        <div class="fiche-section">
                            <h3><i class="fas fa-wrench"></i> Maintenance & Remarques</h3>
                            <div class="fiche-grid">
                                <div class="fiche-item full-width">
                                    <label>Remarques:</label>
                                    <span id="remarques">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Date de visite:</label>
                                    <span id="visitDate">-</span>
                                </div>
                                <div class="fiche-item">
                                    <label>Travail effectué:</label>
                                    <span id="workDone">-</span>
                                </div>
                            </div>
                        </div>

                        <!-- Workflow Status -->
                        <div class="fiche-section">
                            <h3><i class="fas fa-tasks"></i> Suivi du workflow</h3>
                            <div id="workflowStages" class="workflow-stages">
                                <!-- Workflow stages will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- No Results Message -->
            <div id="noResults" class="no-results" style="display: none;">
                <div class="no-results-content">
                    <i class="fas fa-search"></i>
                    <h3>Aucune machine trouvée</h3>
                    <p>Veuillez vérifier les critères de recherche et réessayer.</p>
                </div>
            </div>

            <!-- Instructions -->
            <div id="instructions" class="instructions-panel">
                <div class="instructions-content">
                    <h3><i class="fas fa-info-circle"></i> Instructions</h3>
                    <ul>
                        <li>Utilisez la barre de recherche pour trouver une machine par numéro de série, nom du client ou société</li>
                        <li>Filtrez par type de machine ou statut pour affiner votre recherche</li>
                        <li>Cliquez sur "Rechercher" pour afficher la fiche technique complète</li>
                        <li>Utilisez les boutons "Imprimer" ou "Exporter" pour sauvegarder les informations</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Machine Modal -->
    <div id="addMachineModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cogs"></i> Ajouter une nouvelle machine</h3>
                <button class="close-modal" onclick="closeAddMachineModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMachineForm">
                    <!-- Client Selection -->
                    <div class="form-section">
                        <h4 class="section-title"><i class="fas fa-building"></i> Sélection du client</h4>
                        <div class="form-group client-selection">
                            <label class="form-label">Rechercher un client</label>
                            <input type="text" id="clientSearch" class="form-input" placeholder="Tapez le nom de la société ou du client...">
                            <div id="clientSearchResults" class="search-results" style="display: none;"></div>
                        </div>
                        <div id="selectedClientInfo" class="selected-client">
                            <div class="no-client-selected">
                                <i class="fas fa-building"></i>
                                <p>Aucun client sélectionné</p>
                                <small>Recherchez et sélectionnez un client ci-dessus</small>
                            </div>
                        </div>
                    </div>

                    <!-- Machine Information -->
                    <div class="form-section">
                        <h4 class="section-title"><i class="fas fa-cogs"></i> Informations de la machine</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-barcode"></i> Numéro de série *</label>
                                <input type="text" id="formSerialNumber" name="serialNumber" class="form-input" required placeholder="Ex: OLIVIA-001">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-file-alt"></i> Numéro de fiche *</label>
                                <input type="text" id="formFicheNumber" name="ficheNumber" class="form-input" required placeholder="Ex: FT-001">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-cog"></i> Type de machine *</label>
                                <select id="formMachineType" name="machineType" class="form-input" required>
                                    <option value="">Sélectionner...</option>
                                    <option value="Olivia Standard">Olivia Standard</option>
                                    <option value="Olivia Premium">Olivia Premium</option>
                                    <option value="Olivia Compact">Olivia Compact</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Pricing Information -->
                    <div class="form-section">
                        <h4 class="section-title"><i class="fas fa-euro-sign"></i> Informations de prix</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-euro-sign"></i> Prix HT</label>
                                <input type="number" id="formPrixHT" name="prixHT" class="form-input" step="0.01" placeholder="95000">
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-euro-sign"></i> Prix TTC</label>
                                <input type="number" id="formPrixTTC" name="prixTTC" class="form-input" step="0.01" placeholder="113050">
                            </div>
                        </div>
                    </div>

                    <!-- Payment Information -->
                    <div class="form-section">
                        <h4 class="section-title"><i class="fas fa-credit-card"></i> Informations de paiement</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-money-bill"></i> Type de paiement</label>
                                <select id="formPaymentType" name="paymentType" class="form-input">
                                    <option value="">Sélectionner...</option>
                                    <option value="Crédit">Crédit</option>
                                    <option value="Espèces">Espèces</option>
                                    <option value="Virement">Virement</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-check-circle"></i> Statut de paiement</label>
                                <select id="formPaymentStatus" name="paymentStatus" class="form-input">
                                    <option value="">Sélectionner...</option>
                                    <option value="En cours">En cours</option>
                                    <option value="Payé">Payé</option>
                                    <option value="En attente">En attente</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-clipboard-check"></i> Confirmation</label>
                                <select id="formConfirmation" name="confirmation" class="form-input">
                                    <option value="">Sélectionner...</option>
                                    <option value="Confirmée">Confirmée</option>
                                    <option value="En attente">En attente</option>
                                    <option value="Annulée">Annulée</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label"><i class="fas fa-file-invoice"></i> Facturation</label>
                                <select id="formFacturation" name="facturation" class="form-input">
                                    <option value="">Sélectionner...</option>
                                    <option value="Non facturée">Non facturée</option>
                                    <option value="Facturée">Facturée</option>
                                    <option value="En cours">En cours</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Remarks -->
                    <div class="form-section">
                        <h4 class="section-title"><i class="fas fa-comment"></i> Remarques</h4>
                        <div class="form-group">
                            <label class="form-label">Remarques et notes</label>
                            <textarea id="formRemarques" name="remarques" class="form-input" rows="3" placeholder="Machine standard pour production d'huile d'olive..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeAddMachineModal()">Annuler</button>
                <button type="button" class="btn btn-success" onclick="submitMachineForm()">
                    <i class="fas fa-save"></i> Enregistrer la machine
                </button>
            </div>
        </div>
    </div>

    <script src="/js/template.js"></script>
    <script src="/js/sidebar-nav.js"></script>
    <script src="/js/navigation.js"></script>
    <script src="/js/voir-machines.js"></script>
</body>
</html>
